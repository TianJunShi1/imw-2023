<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width>, initial-scale=1.0">
    <link href="https://fonts.googlefonts.cn/css?family=Do+Hyeon|Lobster|Libre+Baskerville" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <h1>Please use mouse to slide the screen and scratch the black mask.</h1>
        <div class="item">
            <div class="flowers">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>

            <div class="flower flower-7">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-6">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-5">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-4">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-3">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-2">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="flower flower-1">
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
                <div class="petal"></div>
            </div>
            <div class="item-info">
                <p>Project</p>
                <div class="item-info-list">
                    <a href="https://gdes3091tianjunshi.com/P1%20Storybook" target="_blank">P1
                        Storybook</a>
                    <a href="https://gdes3091tianjunshi.com/P2%20Poster/poster" target="_blank">P2
                        Poster/poster</a>
                    <a href="https://gdes3091tianjunshi.com/P3%20Interaction/14545" target="_blank">P3
                        Interaction</a>
                </div>
            </div>
            <canvas id="info1"></canvas>

            <div class="bar"></div>
            <div class="crayon-1">
                <img src="images/crayon.png" alt="">
            </div>
            <div class="crayon-2">
                <img src="images/crayon.png" alt="">
            </div>
        </div>
        <div class="item">
            <span class="wood"></span>
            <div class="cat">
                <div class="body"></div>
                <div class="head">
                    <div class="ear"></div>
                    <div class="ear"></div>
                </div>
                <div class="face">
                    <div class="nose"></div>
                    <div class="whisker-container">
                        <div class="whisker"></div>
                        <div class="whisker"></div>
                    </div>
                    <div class="whisker-container">
                        <div class="whisker"></div>
                        <div class="whisker"></div>
                    </div>
                </div>
                <div class="tail-container">
                    <div class="tail">
                        <div class="tail">
                            <div class="tail">
                                <div class="tail">
                                    <div class="tail">
                                        <div class="tail">
                                            <div class="tail"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="frog" id="frog1">
                <div class="body">
                    <div class="mouth"></div>
                </div>
                <div class="eyes">
                    <div class="eye eye-left">
                        <div class="eye-inner">
                            <div class="pupil">
                                <div class="light"></div>
                            </div>
                        </div>
                    </div>
                    <div class="eye eye-right">
                        <div class="eye-inner">
                            <div class="pupil">
                                <div class="light"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="frog" id="frog2">
                <div class="body">
                    <div class="mouth"></div>
                    <div class="sleepy-icons">
                        <div>Z</div>
                        <div>Z</div>
                        <div>Z</div>
                    </div>
                </div>
                <div class="eyes">
                    <div class="eye eye-left">
                        <div class="eye-inner">
                            <div class="pupil">
                                <div class="light"></div>
                            </div>
                        </div>
                    </div>
                    <div class="eye eye-right">
                        <div class="eye-inner">
                            <div class="pupil">
                                <div class="light"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="item-info">
                <p>Exercise</p>
                <div class="item-info-list">
                    <a href="https://gdes3091tianjunshi.com/E2%20Grid/E2.1.html" target="_blank">E2 Grid</a>
                    <a href="https://gdes3091tianjunshi.com/E3%20Fonts%20%26%20Animation/E3.html" target="_blank">E3
                        Fonts &
                        Animation</a>
                    <a href="https://gdes3091tianjunshi.com/E4%20Flexbox/E4%20Flexbox" target="_blank">E4 Flexbox/E4
                        Flexbox</a>
                    <a href="https://gdes3091tianjunshi.com/E5%20Responsiveness" target="_blank">E5
                        Responsiveness</a>
                    <a href="https://gdes3091tianjunshi.com/E6%20JavaScript/IMW_Winter_2024_E6-JavaScript"
                        target="_blank">E6
                        JavaScript/IMW_Winter_2024_E6-JavaScript</a>
                    <a href="https://gdes3091tianjunshi.com/E7%20jQuery/14429-150/Exercise%206" target="_blank">E7
                        jQuery/Exercise 6</a>
                    <a href="https://gdes3091tianjunshi.com/E8%20JSON/Exercise%208" target="_blank">E8 JSON/Exercise
                        8</a>
                    <a href="https://gdes3091tianjunshi.com/E9%20Favicon/Exercise%209" target="_blank">E9
                        Favicon/Exercise 9</a>
                </div>
            </div>
            <canvas id="info2"></canvas>

            <div class="bar"></div>
            <div class="crayon-1">
                <img src="images/crayon.png" alt="">
            </div>
            <div class="crayon-2">
                <img src="images/crayon.png" alt="">
            </div>
        </div>
        <div class="item">
            <div class="star star-1"></div>
            <div class="star star-2"></div>
            <div class="star star-3"></div>
            <div class="star star-4"></div>
            <div class="star star-5"></div>
            <div class="star star-6"></div>
            <div class="moon"></div>
            <div class="mountain">
                <div class="mountain-shadow"></div>
            </div>

            <div class="item-info">
                <p>Other</p>
                <div class="item-info-list">
                    <a href="otherPage1.html" target="_blank">Reading 1</a>
                    <a href="otherPage2.html" target="_blank">Reading 2</a>
                    <a href="otherPage3.html" target="_blank">Reading 3</a>
                    <a href="otherPage4.html" target="_blank">Readings and resources used 1</a>
                    <a href="otherPage5.html" target="_blank">Other</a>
                </div>
            </div>
            <canvas id="info3"></canvas>

            <div class="bar"></div>
            <div class="crayon-1">
                <img src="images/crayon.png" alt="">
            </div>
            <div class="crayon-2">
                <img src="images/crayon.png" alt="">
            </div>
        </div>
    </div>

    <script>
        class ScratchCard {
            constructor(canvasElement) {
                this.canvasElement = canvasElement
                this.ctxArray = []
                this.widthArray = []
                this.heightArray = []

                this.init()
            }

            init() {
                this.canvasElement.forEach((canvas, index) => {
                    const ctx = canvas.getContext('2d')
                    const width = canvas.offsetWidth
                    const height = canvas.offsetHeight

                    this.ctxArray.push(ctx)
                    this.widthArray.push(width)
                    this.heightArray.push(height)

                    canvas.width = width
                    canvas.height = height
                    ctx.fillStyle = '#000000'
                    ctx.fillRect(0, 0, width, height)
                    ctx.globalCompositeOperation = 'destination-out'

                    canvas.addEventListener('mousemove', (e) => this.handleMove(e, index))
                    canvas.addEventListener('mousedown', (e) => this.handleMove(e, index))
                    canvas.addEventListener('touchmove', (e) => this.handleMove(e, index))
                    canvas.addEventListener('touchstart', (e) => this.handleMove(e, index))
                })
            }

            handleMove(e, index) {
                const ctx = this.ctxArray[index]
                const canvas = this.canvasElement[index]
                const width = this.widthArray[index]
                const height = this.heightArray[index]

                if (e.buttons !== 1 && e.type !== 'touchmove') return

                const bounds = canvas.getBoundingClientRect()
                const x = (e.clientX || e.touches[0].clientX) - bounds.left
                const y = (e.clientY || e.touches[0].clientY) - bounds.top

                ctx.beginPath()
                ctx.arc(x, y, 50, 0, Math.PI * 2)
                ctx.fill()

                this.checkCompletion(ctx, width, height, index)
            }

            checkCompletion(ctx, width, height, index) {
                const imgData = ctx.getImageData(0, 0, width, height)
                const pixel = imgData.data
                let count = 0

                for (let i = 0; i < pixel.length; i += 4) {
                    if (pixel[i + 3] === 0) {
                        count++
                    }
                }

                if (count >= width * height * 0.6) {
                    this.revealText(ctx, width, height, index)
                }
            }

            revealText(ctx, width, height, index) {
                ctx.clearRect(0, 0, width, height)
                ctx.canvas.style.display = "none"
                console.log(ctx.canvas.children)
                document.querySelectorAll(".crayon-1")[index].style.display = "none"
                document.querySelectorAll(".crayon-2")[index].style.display = "none"
            }
        }

        const canvasElements = Array.from(document.querySelectorAll('.item canvas'))
        const scratchCard = new ScratchCard(canvasElements)
    </script>
</body>

</html>